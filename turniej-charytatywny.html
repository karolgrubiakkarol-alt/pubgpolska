<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turniej Charytatywny 2025</title>
    <link rel="icon" href="https://i.imgur.com/HcTRskR.png" type="image/png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Rajdhani:wght@500;600;700&family=Roboto:wght@400;500&family=Roboto+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #ffc107; --dark-bg: #0b0c10; --panel-bg: rgba(20, 22, 25, 0.95); --text-main: #c5c6c7; }
        body { background-color: var(--dark-bg); background: radial-gradient(circle at center, #1a1a1d 0%, #000000 100%); color: var(--text-main); font-family: 'Roboto', sans-serif; margin: 0; padding: 0; line-height: 1.6; }
        .page-wrapper { width: 95%; max-width: 1240px; margin: 40px auto; background-color: var(--panel-bg); border: 1px solid #333; border-top: 4px solid var(--primary); box-shadow: 0 0 50px rgba(0,0,0,0.9); min-height: 100vh; display: flex; flex-direction: column; backdrop-filter: blur(5px); }
        
        /* HEADER & NAV */
        .main-header { background: linear-gradient(180deg, #181818 0%, #121212 100%); padding: 25px; text-align: center; border-bottom: 1px solid #333; position: relative; cursor: pointer; }
        .main-header::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, var(--primary), transparent); }
        .header-logo { max-width: 280px; height: auto; display: block; margin: 0 auto; transition: transform 0.3s; filter: drop-shadow(0 0 10px rgba(255,193,7,0.1)); }
        .main-header:hover .header-logo { transform: scale(1.05); filter: drop-shadow(0 0 20px rgba(255,193,7,0.4)); }
        .main-navbar { background-color: #0f0f0f; padding: 0; display: flex; justify-content: center; flex-wrap: wrap; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 1000; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .main-navbar a { color: #888; text-decoration: none; font-family: 'Rajdhani', sans-serif; font-size: 1.2em; font-weight: 700; text-transform: uppercase; padding: 18px 25px; transition: 0.3s; position: relative; letter-spacing: 1px; }
        .main-navbar a:hover, .main-navbar a.active { color: var(--primary); background: rgba(255, 193, 7, 0.05); text-shadow: 0 0 8px rgba(255, 193, 7, 0.6); }
        .main-navbar a.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: var(--primary); box-shadow: 0 -2px 10px var(--primary); }

        .content-padding { padding: 40px 20px; flex-grow: 1; }
        h3 { font-family: 'Oswald', sans-serif; font-size: 2em; color: var(--primary); border-bottom: 1px solid #444; padding-bottom: 15px; margin-top: 50px; text-transform: uppercase; letter-spacing: 1px; }

        .internal-navbar { background: rgba(255,255,255,0.03); padding: 15px; text-align: center; border: 1px solid #333; margin-bottom: 40px; display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; border-radius: 4px; }
        .internal-navbar a { color: #ccc; text-decoration: none; font-family: 'Rajdhani', sans-serif; font-weight: 600; text-transform: uppercase; padding: 8px 16px; border: 1px solid transparent; transition: 0.3s; border-radius: 4px; }
        .internal-navbar a:hover { border-color: var(--primary); color: var(--primary); background: rgba(255,193,7,0.1); transform: translateY(-2px); }

        .cta-button { display: inline-block; background: var(--primary); color: #000; padding: 15px 40px; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.2em; text-decoration: none; text-transform: uppercase; clip-path: polygon(10% 0, 100% 0, 100% 80%, 90% 100%, 0 100%, 0 20%); transition: all 0.2s ease; border: none; cursor: pointer; box-shadow: 0 0 15px rgba(255,193,7,0.3); margin-top: 15px; }
        .cta-button:hover { background: #fff; transform: scale(1.05); box-shadow: 0 0 25px rgba(255,193,7,0.6); }

        .info-list { list-style: none; padding: 0; }
        .info-list li { background: rgba(255,255,255,0.03); padding: 15px; margin-bottom: 10px; border-left: 3px solid var(--primary); display: flex; align-items: center; transition: 0.3s; flex-wrap: wrap; }
        .info-list li:hover { background: rgba(255,255,255,0.07); padding-left: 20px; }
        .info-list strong { color: var(--primary); min-width: 150px; font-family: 'Rajdhani', sans-serif; font-size: 1.1em; text-transform: uppercase; }
        .info-list a { color: #fff; text-decoration: underline; }

        /* SPONSORZY */
        .top-sponsors-container { display: flex; justify-content: center; align-items: flex-end; gap: 30px; flex-wrap: wrap; margin-bottom: 50px; text-align: center; }
        .sponsor-placeholder { background: #000; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.5); margin: 0 auto 10px auto; border-radius: 6px; }
        .sponsor-placeholder img { width: 100%; height: 100%; object-fit: contain; }
        
        .tier-1 .sponsor-placeholder { width: 220px; height: 220px; border: 2px solid var(--primary); box-shadow: 0 0 30px rgba(255,193,7,0.2); }
        .tier-1 .sponsor-name { font-size: 1.8em; color: var(--primary); font-family: 'Oswald'; text-shadow: 0 0 10px rgba(255,193,7,0.5); display:block; }
        
        .tier-2 .sponsor-placeholder { width: 160px; height: 160px; border: 2px solid #c0c0c0; }
        .tier-2 .sponsor-name { font-size: 1.2em; color: #e0e0e0; font-family: 'Oswald'; display:block; }
        
        .tier-3 .sponsor-placeholder { width: 140px; height: 140px; border: 2px solid #cd7f32; }
        .tier-3 .sponsor-name { font-size: 1.1em; color: #cd7f32; font-family: 'Oswald'; display:block; }

        .sponsor-amount { background: var(--primary); color: #000; padding: 2px 8px; font-weight: bold; font-size: 0.85em; border-radius: 2px; font-family: 'Rajdhani', sans-serif; }
        
        .sponsor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 30px; }
        .sponsor-card { background: rgba(30, 30, 30, 0.6); border: 1px solid #333; padding: 15px; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; position: relative; overflow: hidden; border-radius: 4px; }
        .sponsor-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--primary); }
        .sponsor-card:hover { background: #252525; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.5); border-color: #555; }
        .sponsor-name-small { color: #fff; font-weight: bold; }



        /* TEAMY */
        .team-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        @media (max-width: 900px) { .team-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .team-grid { grid-template-columns: 1fr; } }
        
        .team-card { background: linear-gradient(135deg, #222 0%, #1a1a1a 100%); padding: 0; border: 1px solid #333; border-left: 4px solid var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: 0.3s; border-radius: 4px; }
        .team-card:hover { transform: translateY(-5px); border-color: #555; box-shadow: 0 10px 25px rgba(0,0,0,0.6); }
        .team-card-header { padding: 15px; background: rgba(255,255,255,0.02); font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.1em; color: var(--primary); cursor: pointer; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #333; }
        .team-number { background: #333; color: #aaa; padding: 2px 8px; font-size: 0.7em; border-radius: 2px; }
        .player-sublist { padding: 15px; margin: 0; list-style: none; display: none; background: #151515; }
        .player-sublist.expanded { display: block; animation: fadeIn 0.3s ease; }
        .player-sublist li { border-bottom: 1px solid #222; padding: 8px 0; color: #bbb; font-size: 0.95em; }
        .captain { color: var(--primary); font-weight: bold; }

        /* TABELE */
        .tabs-nav { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 20px; border: none; }
        .tab-link { background: #222; color: #888; border: 1px solid #333; padding: 10px 25px; flex-grow: 1; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.2em; text-transform: uppercase; transition: 0.3s; }
        .tab-link:hover { background: #333; color: #fff; }
        .tab-link.active { background: var(--primary); color: #000; border-color: var(--primary); box-shadow: 0 0 15px rgba(255,193,7,0.4); }
        .tab-content { display: none; padding: 15px; background: #1a1a1a; border: 1px solid #333; border-top: none; }
        .tab-content.active { display: block; }
        
        .results-table-container { overflow-x: auto; }
        .results-table { width: 100%; border-collapse: collapse; background: #1a1a1a; min-width: 600px; }
        .results-table th { background: #2a2a2a; color: var(--primary); padding: 15px; text-align: center; font-family: 'Rajdhani', sans-serif; font-size: 1.1em; text-transform: uppercase; border-bottom: 2px solid var(--primary); }
        .results-table td { border: 1px solid #333; padding: 12px; text-align: center; color: #ccc; font-family: 'Roboto Mono', monospace; }
        .results-table td:nth-child(2) { text-align: left; font-weight: bold; color: #fff; font-family: 'Roboto', sans-serif; }

        .rules-container { background: #111; padding: 25px; border: 1px solid #333; max-height: 500px; overflow-y: auto; font-family: 'Roboto Mono', monospace; color: #aaa; font-size: 0.9em; white-space: pre-wrap; }
        .collapsible-trigger { cursor: pointer; }
        .collapsible-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
        .collapsible-content.expanded { max-height: 5000px; }

        footer { text-align: center; padding: 30px; margin-top: 60px; color: #555; border-top: 1px solid #333; font-size: 0.9em; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="page-wrapper">

    <header class="main-header">
        <a href="https://www.pubgpolska.pl/">
            <img src="https://i.imgur.com/O50RI1X.png" alt="PUBG POLSKA" class="header-logo">
        </a>
    </header>

    <nav class="main-navbar">
        <a href="https://www.pubgpolska.pl/">Strona Główna</a>
        
        <a href="turniej-charytatywny.html" class="active">Turniej Charytatywny 2025</a>
        
        <a href="pubg-polska-cup.html">PUBG POLSKA CUP 2025</a>
        <a href="fantasycoach.html">Fantasy Coach</a>
    </nav>
    <div class="content-padding">

        <nav class="internal-navbar">
            <a href="#zapisy">Zapisz się</a>
            <a href="#szczegoly">Szczegóły</a>
            <a href="#sponsorzy">Sponsorzy</a>
            <a href="#teamy">Zapisane Teamy</a>
            <a href="#regulamin">Regulamin</a>
        </nav>

        <section id="zapisy" style="text-align: center; background: rgba(30,30,30,0.5); padding: 30px; border:1px solid #333; border-radius: 4px; margin-bottom: 40px;">
            <h3 style="margin-top: 0; border:none;">Zapisy na Turniej Charytatywny</h3>
            <p style="color: #ccc;">Zagraj dla szczytnego celu! Liczba miejsc ograniczona do 25 drużyn.</p>
            <p style="font-size: 0.9em; color: #ffc107; margin-bottom: 15px; font-weight:bold;">Wpłata 100 zł gwarantuje slot (priorytet).</p>

            <a href="https://docs.google.com/forms/d/e/1FAIpQLSfGB21E8OwUtvnRO8lMQIuxgU2anyB7JHFuBXMoqbIbBP_TpA/viewform?usp=header"
               target="_blank"
               class="cta-button">
                WYPEŁNIJ FORMULARZ
            </a>
        </section>

        <section id="szczegoly">
            <h3>Szczegóły Turnieju</h3>
            <ul class="info-list">
                <li><strong>Data:</strong> 13 Grudnia 2025 (Sobota), godz. 18:00</li>
                <li><strong>Format:</strong> SQUAD FPP (4 os.) | Max 25 Drużyn</li>
		<li><strong>Wpłaty:</strong> Chętnych do dołożenia się do szczytnego celu prosimy o skontaktowanie się ze  <a href="https://discordapp.com/users/610995594189864980" target="_blank" style="margin-left:5px;">Złotym</a> który po turnieju wpłaci całą zebraną kwotę na zbiórkę w ramach wsparcia od naszej społeczności PUBG.</li>
                <li><strong>Cel:</strong> 100% puli idzie na leczenie 4 letniego Borysa, który cierpi na zespół wad wrodzonych</li>
		<li><strong>Link do zbiórki:</strong> <a href="https://sercadlamaluszka.pl/nasi-podopieczni/borys-mytko" target="_blank" style="margin-left:5px;">sercadlamaluszka.pl/nasi-podopieczni/borys-mytko</a></li>
                <li><strong>Mapy:</strong> 2x Miramar, Rondo, Taego, 2x Erangel</li>
                <li><strong>Nagrody:</strong> Tytuł Mistrza Turnieju Charytatywnego + satysfakcja</li>
                <li><strong>Transmisja:</strong> <a href="https://www.twitch.tv/rych_jj" target="_blank" style="margin-left:5px;">twitch.tv/rych_jj</a></li>
            </ul>
        </section>

        <section id="sponsorzy">
            <h3 class="collapsible-trigger">Darczyńcy</h3>
            <div class="collapsible-content expanded">
                <p style="text-align: center; color: #bbb; margin-bottom: 30px;">
                    Dziękujemy że razem z nami wspierasz potrzebujących!
                </p>

                <div class="top-sponsors-container">
                    <div class="tier-2">
                        <div class="sponsor-placeholder">
    			            <img src="https://i.imgur.com/2MRwBfA.png" alt="CPN">
                        </div>
                        <span class="sponsor-name">CPN</span><br>
                        <span class="sponsor-amount">300 PLN</span>
                    </div>
                    <div class="tier-1">
                       <div class="sponsor-placeholder">
    			            <img src="https://i.imgur.com/lgirlaA.png" alt="SAY-10">
		               </div>
                        <span class="sponsor-name">SAY-10</span><br>
                        <span class="sponsor-amount">450 PLN</span>
                    </div>
                    <div class="tier-3">
                        <div class="sponsor-placeholder">
			                <img src="https://zrpat.pl/images/pytajnik.jpg" alt="Arfakianka">
                        </div>
                        <span class="sponsor-name">Arfakianka</span><br>
                        <span class="sponsor-amount">200 PLN</span>
                    </div>
                </div>

                
                <div class="sponsor-grid">
		    <div class="sponsor-card"><span class="sponsor-name-small">6games6points</span><span class="sponsor-amount">160 PLN</span></div>
		    <div class="sponsor-card"><span class="sponsor-name-small">YBK</span><span class="sponsor-amount">150 PLN</span></div>
		    <div class="sponsor-card"><span class="sponsor-name-small">Perła Gaming</span><span class="sponsor-amount">125 PLN</span></div> 
		    <div class="sponsor-card"><span class="sponsor-name-small">Noob Busters</span><span class="sponsor-amount">100 PLN</span></div>
		    <div class="sponsor-card"><span class="sponsor-name-small">Hot sukkubus</span><span class="sponsor-amount">100 PLN</span></div>
		    <div class="sponsor-card"><span class="sponsor-name-small">ICC</span><span class="sponsor-amount">100 PLN</span></div>
                    <div class="sponsor-card"><span class="sponsor-name-small">MorderczeJajo</span><span class="sponsor-amount">100 PLN</span></div>
		    <div class="sponsor-card"><span class="sponsor-name-small">B-Unit</span><span class="sponsor-amount">100 PLN</span></div>
                    <div class="sponsor-card"><span class="sponsor-name-small">2IQ</span><span class="sponsor-amount">100 PLN</span></div>
                    <div class="sponsor-card"><span class="sponsor-name-small">UFO Porno</span><span class="sponsor-amount">100 PLN</span></div>
		    <div class="sponsor-card"><span class="sponsor-name-small">ARMIA</span><span class="sponsor-amount">100 PLN</span></div>
                    <div class="sponsor-card"><span class="sponsor-name-small">FoodMarketAcademy </span><span class="sponsor-amount">100 PLN</span></div>
		    <div class="sponsor-card"><span class="sponsor-name-small">John Abruzzi</span><span class="sponsor-amount">50 PLN</span></div>
		    <div class="sponsor-card"><span class="sponsor-name-small">Najcik</span><span class="sponsor-amount">50 PLN</span></div>                                       
		    <div class="sponsor-card"><span class="sponsor-name-small">Pufax</span><span class="sponsor-amount">50 PLN</span></div>                                       
		    <div class="sponsor-card"><span class="sponsor-name-small">Cykusss</span><span class="sponsor-amount">30 PLN</span></div>                                       

                </div>

                <div style="text-align:center; margin-top:30px; font-size:1.5em; border-top:1px solid #444; padding-top:20px; color:#fff; font-family:'Oswald';">
                    Łączna suma zebrana: <strong style="color:#ffc107">0 PLN</strong>
                </div>
            </div>
        </section>

        <section id="teamy">
            <h3 class="collapsible-trigger">Zapisane Teamy</h3>
            <div class="collapsible-content expanded">
                <p style="color:#bbb; margin-bottom:20px;">Lista pobierana na żywo z arkusza zapisów. Pierwszeństwo mają drużyny z wpłatą.</p>
                <div id="team-list-dynamic" class="team-grid">
                    <p>Ładowanie listy drużyn...</p>
                </div>
            </div>
        </section>

        <section id="wyniki">
            <h3>Wyniki Końcowe</h3>
            <div class="tabs-nav">
                <button class="tab-link active" data-tab="generalna">Generalna</button>
                <button class="tab-link" data-tab="gra1">Gra 1</button>
                <button class="tab-link" data-tab="gra2">Gra 2</button>
                <button class="tab-link" data-tab="gra3">Gra 3</button>
                <button class="tab-link" data-tab="gra4">Gra 4</button>
                <button class="tab-link" data-tab="gra5">Gra 5</button>
                <button class="tab-link" data-tab="gra6">Gra 6</button>
            </div>

            <div id="tab-generalna" class="tab-content active">
                <div class="results-table-container">
                    <table class="results-table"><thead><tr><th>#</th><th>Team</th><th>Pkt (Rank)</th><th>Kills</th><th>Suma</th></tr></thead><tbody></tbody></table>
                </div>
            </div>
            <div id="tab-gra1" class="tab-content"><div class="results-table-container"><table class="results-table"><thead><tr><th>#</th><th>Team</th><th>Pkt</th><th>Kills</th><th>Suma</th></tr></thead><tbody></tbody></table></div></div>
            <div id="tab-gra2" class="tab-content"><div class="results-table-container"><table class="results-table"><thead><tr><th>#</th><th>Team</th><th>Pkt</th><th>Kills</th><th>Suma</th></tr></thead><tbody></tbody></table></div></div>
            <div id="tab-gra3" class="tab-content"><div class="results-table-container"><table class="results-table"><thead><tr><th>#</th><th>Team</th><th>Pkt</th><th>Kills</th><th>Suma</th></tr></thead><tbody></tbody></table></div></div>
            <div id="tab-gra4" class="tab-content"><div class="results-table-container"><table class="results-table"><thead><tr><th>#</th><th>Team</th><th>Pkt</th><th>Kills</th><th>Suma</th></tr></thead><tbody></tbody></table></div></div>
            <div id="tab-gra5" class="tab-content"><div class="results-table-container"><table class="results-table"><thead><tr><th>#</th><th>Team</th><th>Pkt</th><th>Kills</th><th>Suma</th></tr></thead><tbody></tbody></table></div></div>
            <div id="tab-gra6" class="tab-content"><div class="results-table-container"><table class="results-table"><thead><tr><th>#</th><th>Team</th><th>Pkt</th><th>Kills</th><th>Suma</th></tr></thead><tbody></tbody></table></div></div>
        </section>

        <section id="regulamin" style="text-align: center; padding-bottom: 50px;">
            <h3>Regulamin Turnieju</h3>
            <p style="color: #ccc; margin-bottom: 30px; max-width: 800px; margin-left: auto; margin-right: auto;">
                Pełny regulamin wydarzenia, zasady punktacji oraz wymogi techniczne znajdują się w dokumencie PDF.
                Kliknij przycisk poniżej, aby go pobrać lub otworzyć.
            </p>
            
            <a href="Regulamin TURNIEJU CHARYTATYWNEGO 2025.pdf" target="_blank" class="cta-button">
                POBIERZ REGULAMIN (PDF)
            </a>
        </section>

        <section id="kontakt">
            <h3>Kontakt</h3>
            <p style="color:#ccc;">W razie pytań zapraszamy na Discord:</p>
            <ul class="info-list">
                <li><strong>Organizator:</strong> <a href="https://discordapp.com/users/610995594189864980" target="_blank">Złoty</a></li>
                <li><strong>Dział techniczny:</strong> <a href="https://discordapp.com/users/605726001539973121" target="_blank">KAROL3K</a></li>
            </ul>
        </section>

    </div>

    <footer>
        © 2025 PUBG POLSKA. Strona nie jest powiązana z KRAFTON, Inc.
    </footer>
</div>

<script>
    // ==========================================
    // KONFIGURACJA: SŁOWNIK POPRAWEK NAZW DRUŻYN
    // ==========================================
    // Tutaj wpisujemy błędne nazwy (z lewej, małymi literami) i poprawne (z prawej).
    const TEAM_NAME_MAPPING = {
        "batalion zaska": "Batalion Zoska",   // Poprawa literówki
        "perla gaming": "PERLA GAMING",       // Poprawa L na Ł
        "calkowity potencjal nieuwolniony": "Calkowity Potencjal NieUwolniony", // Polskie znaki
        "hot sukkubus": "Hot Sukkubus",       // Wielka litera
        "foodmarketacademy": "FoodMarketAcademy", // Brak spacji
        "noob busters": "Noob Busters",
        "2iq team": "2IQ Team",
        "6games6points": "6games6points",
        "ufo porno": "UFO Porno",
        "essa": "ESSA",
        "say-10": "SAY-10",
        "armia": "ARMIA",
        "green8": "Green8",
        "zerohaha": "ZeroHahe",
        "ruthlesscrew": "RuthlessCrew",
        "ybk": "YBK",
        "kwadratowe bambusy": "Kwadratowe Bambusy",
        "icc": "ICC"
    };

    // ==========================================
    // 1. OBLICZANIE SUMY WPŁAT
    // ==========================================
    function calculateTotalDonations() {
        let total = 0;
        document.querySelectorAll('.sponsor-amount').forEach(element => {
            let cleanText = element.textContent.toLowerCase().replace(/[^0-9,.]/g, '').replace(',', '.');
            let val = parseFloat(cleanText);
            if (!isNaN(val)) total += val;
        });
        const totalDisplay = document.querySelector('.collapsible-content strong[style="color:#ffc107"]');
        if (totalDisplay) totalDisplay.textContent = total.toFixed(2) + ' PLN';
    }
    calculateTotalDonations();

    // ==========================================
    // 2. POZOSTAŁE FUNKCJE UI
    // ==========================================
    function sortSponsors() {
        const grid = document.querySelector('.sponsor-grid');
        if(!grid) return;
        const cards = Array.from(grid.querySelectorAll('.sponsor-card'));
        cards.sort((a, b) => {
            const getAmount = (el) => parseFloat(el.querySelector('.sponsor-amount').textContent.replace(/[^0-9,.]/g, '').replace(',', '.')) || 0;
            return getAmount(b) - getAmount(a);
        });
        grid.innerHTML = '';
        cards.forEach(card => grid.appendChild(card));
    }
    sortSponsors();

    document.querySelectorAll('.collapsible-trigger').forEach(header => {
        header.addEventListener('click', () => {
            const content = header.nextElementSibling;
            if (content) content.classList.toggle('expanded');
        });
    });

    function parseCSVRow(row) {
        const columns = [];
        let current = '';
        let inQuotes = false;
        for(let i=0; i<row.length; i++){
            if(row[i] === '"') { inQuotes = !inQuotes; }
            else if(row[i] === ',' && !inQuotes) { columns.push(current); current = ''; }
            else { current += row[i]; }
        }
        columns.push(current);
        return columns.map(c => c.trim().replace(/^"|"$/g, ''));
    }

    // ==========================================
    // 3. POBIERANIE SKŁADÓW
    // ==========================================
    const TEAMS_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vScvP0CCSXI2M-iz8wNoASNqPNFCWTUFrRBRzyqdQgjo8hPLdYha-rLV35rmAk3OUbzhnGKjVJpkIIK/pub?output=csv';

    async function loadTeams() {
        const list = document.getElementById('team-list-dynamic');
        try {
            const response = await fetch(TEAMS_SHEET_URL);
            if(!response.ok) throw new Error("Błąd sieci");
            const rows = (await response.text()).split(/\r?\n/).slice(1);
            
            list.innerHTML = '';
            let count = 0;

            rows.forEach(row => {
                if(!row.trim()) return;
                const cols = parseCSVRow(row);
                const teamName = cols[12]; 
                if(!teamName) return; 

                count++;
                const card = document.createElement('div');
                card.className = 'team-card';
                card.innerHTML = `
                    <div class="team-card-header">
                        <span class="team-number">${count}.</span>
                        <span class="team-name">${teamName}</span>
                    </div>
                    <ul class="player-sublist">
                        ${cols[2] ? `<li class="captain">${cols[2]} (C)</li>` : ''}
                        ${cols[4] ? `<li>${cols[4]}</li>` : ''}
                        ${cols[6] ? `<li>${cols[6]}</li>` : ''}
                        ${cols[8] ? `<li>${cols[8]}</li>` : ''}
                        ${cols[10] ? `<li>${cols[10]} (Rez)</li>` : ''}
                    </ul>`;
                card.querySelector('.team-card-header').addEventListener('click', function() { this.nextElementSibling.classList.toggle('expanded'); });
                list.appendChild(card);
            });
            if(count === 0) list.innerHTML = '<p style="padding:10px; color:#bbb;">Brak drużyn.</p>';
        } catch(e) { console.log(e); }
    }
    loadTeams();

    // ==========================================
    // 4. POBIERANIE WYNIKÓW (Z NORMALIZACJĄ NAZW)
    // ==========================================
    const RESULTS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTJI2BqSXSxXyCvWvXEwgHC-kaH7ijYdTY30IDcdYa-JA_YlBL8NoIblDmOFduSwWAr3CrJ4MvNStRD/pub?gid=0&single=true&output=csv';

    async function loadTournamentResults() {
        try {
            const response = await fetch(RESULTS_CSV_URL);
            const rows = (await response.text()).split(/\r?\n/);

            const matchesData = { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [] };
            const generalStandings = new Map(); 

            let currentMatch = 0;

            rows.forEach((row, index) => {
                if(!row.trim()) return;
                const cols = parseCSVRow(row);
                
                // Wykrywanie numeru meczu
                const rowString = row.toUpperCase();
                if (rowString.includes("MECZ 1") || (cols[0] && cols[0].includes("1") && cols[0].length < 5)) currentMatch = 1;
                else if (rowString.includes("MECZ 2") || (cols[0] && cols[0].includes("2") && cols[0].length < 5)) currentMatch = 2;
                else if (rowString.includes("MECZ 3") || (cols[0] && cols[0].includes("3") && cols[0].length < 5)) currentMatch = 3;
                else if (rowString.includes("MECZ 4") || (cols[0] && cols[0].includes("4") && cols[0].length < 5)) currentMatch = 4;
                else if (rowString.includes("MECZ 5") || (cols[0] && cols[0].includes("5") && cols[0].length < 5)) currentMatch = 5;
                else if (rowString.includes("MECZ 6") || (cols[0] && cols[0].includes("6") && cols[0].length < 5)) currentMatch = 6;

                // Pomijanie nagłówków
                if (currentMatch === 0 || rowString.includes("MIEJSCE") || rowString.includes("RANK")) return;

                // Pobranie surowej nazwy
                let rawTeamName = cols[2];
                if (!rawTeamName) return; 

                // --- NORMALIZACJA NAZWY (NAPRAWA DUPLIKATÓW) ---
                let cleanName = rawTeamName.trim(); // Usuń spacje z przodu/tyłu
                let lookupKey = cleanName.toLowerCase(); // Zamień na małe litery do szukania w słowniku

                // Jeśli nazwa jest w słowniku poprawek, użyj poprawnej wersji
                // Jeśli nie, użyj oryginalnej (ale bez spacji na końcach)
                let finalTeamName = TEAM_NAME_MAPPING[lookupKey] || cleanName;

                // Klucz do mapy generalnej (lowercase)
                const mapKey = finalTeamName.toLowerCase();

                // Parsowanie liczb
                const killPts = parseFloat((cols[4] || "0").replace(',', '.')) || 0;
                const rankPts = parseFloat((cols[5] || "0").replace(',', '.')) || 0;
                const totalPts = parseFloat((cols[6] || "0").replace(',', '.')) || 0;

                // Dodaj do meczu (używając już POPRAWIONEJ nazwy)
                matchesData[currentMatch].push({ team: finalTeamName, killPts, rankPts, totalPts });

                // Dodaj do generalki (używając POPRAWIONEJ nazwy)
                if (!generalStandings.has(mapKey)) {
                    generalStandings.set(mapKey, { team: finalTeamName, killPts: 0, rankPts: 0, totalPts: 0 });
                }
                const currentStats = generalStandings.get(mapKey);
                currentStats.killPts += killPts;
                currentStats.rankPts += rankPts;
                currentStats.totalPts += totalPts;
            });

            // Renderowanie Generalnej
            const generalArray = Array.from(generalStandings.values());
            generalArray.sort((a, b) => b.totalPts - a.totalPts);
            renderTable('tab-generalna', generalArray);

            // Renderowanie Meczów
            for (let i = 1; i <= 6; i++) {
                if (matchesData[i].length > 0) {
                    matchesData[i].sort((a, b) => b.totalPts - a.totalPts);
                    renderTable(`tab-gra${i}`, matchesData[i]);
                } else {
                    const tbody = document.querySelector(`#tab-gra${i} tbody`);
                    if(tbody) tbody.innerHTML = '<tr><td colspan="5" style="padding:20px; color:#777;">Brak wyników. Sprawdź format arkusza.</td></tr>';
                }
            }

        } catch (e) { console.error("Błąd skryptu:", e); }
    }

    function renderTable(tabId, data) {
        const tbody = document.querySelector(`#${tabId} tbody`);
        if (!tbody) return;
        tbody.innerHTML = '';
        data.forEach((row, index) => {
            const tr = document.createElement('tr');
            let color = '#ccc';
            if(index===0) color='#ffd700'; else if(index===1) color='#c0c0c0'; else if(index===2) color='#cd7f32';
            
            const fmt = (n) => n % 1 === 0 ? n : n.toFixed(1);
            tr.innerHTML = `
                <td style="color:${color}; font-weight:bold;">${index + 1}.</td>
                <td style="color:${index < 3 ? '#fff' : '#ccc'}; font-weight:${index < 3 ? 'bold' : 'normal'}">${row.team}</td>
                <td>${fmt(row.rankPts)}</td>
                <td>${fmt(row.killPts)}</td>
                <td style="color:var(--primary); font-weight:bold; font-size:1.1em;">${fmt(row.totalPts)}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    // Uruchomienie zakładek
    document.querySelectorAll('.tab-link').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.tab-link').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            const target = document.getElementById('tab-' + btn.dataset.tab);
            if(target) target.classList.add('active');
        });
    });

    loadTournamentResults();
</script>

</body>
</html>